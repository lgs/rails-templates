log 'Gemfile'
    inject_into_file "./Gemfile", 
                     "gem 'rack', '1.1.0', :git => 'git://github.com/rails/rack.git'
                      \ngem 'rack-mount'\ngem 'rack-test', '~> 0.5.0'\n", 
                      :before => "source 'http://rubygems.org'"

    inject_into_file "./Gemfile", :after => "# Bundle the gems you use:" do
      "\ngem 'haml', '3.0.0.beta.3'\ngem 'compass', '0.10.0.pre9'\ngem 'devise', '1.1.pre4'"
    end

log 'collect the gems your application requires'
    run('bundle')# install')
    run('haml --rails .') 
    run('compass --rails -f blueprint . --css-dir=public/stylesheets/compiled --sass-dir=app/stylesheets')

log 'rm public/index.html'
  inside('public') do
    run('rm index.html')
  end

#log 'edit config/initializers/compass.rb'
#   gsub_file 'config/initializers/compass.rb', /Compass.configuration.parse(File.join(RAILS_ROOT, "config", "compass.config"))/, 'Compass.add_project_configuration("config/compass.config")'

log 'edit config/initializers/compass.rb'
run "rm config/initializers/compass.rb"
File.open('config/initializers/compass.rb', "w") do |f|
  f.puts <<-COMPASS
    # If you have any compass plugins, require them here.
    #Compass.configuration.parse(File.join(RAILS_ROOT, "config", "compass.config"))
    Compass.add_project_configuration("config/compass.config")
    Compass.configuration.environment = RAILS_ENV.to_sym
    Compass.configure_sass_plugin!
  COMPASS
end

# DEVISE AUTHENTICATION: # to evoid (Compass::Error) put devise_install after editing Compass
log 'rails generate devise_install'
    run "script/rails g devise_install"
    run "script/rails g devise User"
    run "script/rails g devise_views"
    run "mv devise app/views"
    run "rake db:create db:migrate"
    run "script/rails g controller home index"
    inject_into_file "config/routes.rb", "\n\n  root :to => 'home#index'", :after => "devise_for :users"

log 'remove Prototype defaults'
run "rm public/javascripts/controls.js"
run "rm public/javascripts/dragdrop.js"
run "rm public/javascripts/effects.js"
run "rm public/javascripts/prototype.js"
 
log 'Your Body HTML is in app/views/layouts/application.html.erb'
File.open('app/views/layouts/application.html.erb', "w") do |f|
  f.puts <<-ERB

  <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
  <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
  <head>
  <title>Application!</title>
  <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js" type="text/javascript"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.7.2/jquery-ui.min.js" type="text/javascript"></script>
  <%= stylesheet_link_tag 'main' %>
  </head>
  <body>
     <%= yield %>
  </body>
  </html>
  ERB
end

run "rm app/views/home/index.html.erb"
File.open('app/views/home/index.html.erb', "w") do |f|
  f.puts <<-INDEX

<div id='header'>
  <div id='logo'>
  </div>
  <div class='column last span-19'>
  </div>
</div>
<div id='wrapper'>
  <div class='column span-3'>
  </div>
  <div id='content'>
      <p>Lorem Ipsum...</p>
Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Praesent est leo, consectetuer quis, mollis nec, tristique ac, velit. Duis a est. In vel mi. Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Ut bibendum nulla ac lorem ullamcorper tincidunt. Vivamus hendrerit turpis vitae felis. Mauris vel urna non nisl facilisis ultrices. Integer vitae arcu. Nulla eleifend eros eget justo. Etiam sodales, pede sit amet ornare dictum, eros neque dictum eros, id luctus risus leo in quam. Sed vitae nibh tincidunt magna sagittis ornare. Maecenas accumsan pretium lacus. Donec eleifend lacus sed dolor. Morbi felis augue, viverra blandit, vulputate nec, pellentesque non, nibh. Vestibulum vitae dui.
  </div>
  <div class='column last span-3'>
  </div>
</div>
<div id='footer'>
  <div class='column last span-24'>
  </div>
</div>

  INDEX
end

log 'Your Grid CSS is in public/stylesheets/compiled/main.css'
File.open('public/stylesheets/main.css', "w") do |f|
  f.puts <<-CSS

.column { float: left; margin-right: 10px; }
.last { margin-right: 0; }
.span-19 { width: 750px; }
.span-3 { width: 110px; }
.span-24 { width: 950px; margin: 0; }
#header { width: 950px; margin: 0 auto; color: eee; }
#logo { float: left; margin-right: 10px; width: 190px; }
#wrapper { width: 950px; margin: 0 auto; }
#content { float: left; margin-right: 10px; width: 710px; color: grey; }
#footer { width: 950px; margin: 0 auto; color: eee; } 

  CSS
end
